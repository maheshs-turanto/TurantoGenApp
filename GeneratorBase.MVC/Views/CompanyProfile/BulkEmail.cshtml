@{
    ViewBag.Title = "Edit Company Profile";
}
@functions {
    object getHtmlAttributes(string Property)
    {
        return new { @class = "form-control" };
    }
}
<link href='@Url.Content("~/Scripts/summernote.css")' rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/summernote.js")" type="text/javascript"></script>
<script type="text/javascript">
    function initHtmlEditor() {
        $('#summernote').summernote();
        $('#summernote1').summernote();
    }
    $(document).ready(function () {
        initHtmlEditor();
    });
    function ChangeProfile(obj) {
        var element = $(obj);
        var value = element.val();
        var url = '@Url.Action("Edit", "CompanyProfile", new { tenantId = "_tenantid" })'.replace("_tenantid", value);
        window.location.href = url;
    }
</script>

<div class="content-heading">
    <div class="col-lg-8">
        <strong>
            <a href="@Url.Action("Index", "Admin")"> Admin</a> <small>Email Notification</small>
        </strong>
    </div>
</div>

@if (ViewBag.Message != null)
{
    if (!ViewBag.Message.Contains("SMTP Issue"))
    {
        <script>
            alert("Email sent to users.")
            window.location.href = '@Url.Action("Index","Admin")'; //added by rachana to redirect after Email to application users
        </script>
    }
    else
    {
        <script>
            alert(ViewBag.Message + ": Email not sent")
        </script>
    }
}

<div class="">
    <div class="">
        <div class="card-heading">
            <div class="">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#Details">Send email to users</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="Details">
                        @using (Html.BeginForm("BulkEmail", "CompanyProfile", FormMethod.Post, new { enctype = "multipart/form-data" }))
                        {
                            @Html.AntiForgeryToken()
                            <div class="card-body card-deck">

                                @Html.ValidationSummary(true)
                                @if (ViewBag.TenantList != null)
                                {
                                    <div class='col-md-6 col-sm-6 col-xs-12 p-0'>
                                        <div class='input-group'>
                                            <label class="col-sm-3 col-md-3 col-xs-12 p-0">Select Tenant</label>
                                            <div class="input-group col-sm-9 col-md-9 col-xs-12 p-0">
                                                @Html.DropDownList("TenantList", null, null, new { @multiple = "multiple" })
                                            </div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    if (ViewBag.RoleList != null)
                                    {
                                        <div class='col-md-6 col-sm-6 col-xs-12 p-0'>
                                            <div class='input-group'>
                                                <label class="col-sm-3 col-md-3 col-xs-12 p-0">Select roles</label>
                                                <div class="input-group col-sm-9 col-md-9 col-xs-12 p-0">
                                                    @Html.DropDownList("RoleList", null, null, new { @multiple = "multiple" })
                                                    @Html.TextBox("RoleListValue", null, new { @class = "form-control d-none" })
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }

                                <div class="col-md-6 col-sm-6 col-xs-12 p-0">
                                    <div class='input-group '>
                                        <label class="col-sm-3 col-md-3 col-xs-12 p-0">Subject <span class="text-danger-reg">*</span> </label>
                                        <div class="input-group col-sm-9 col-md-9 col-xs-12 p-0">
                                            @Html.TextBox("subject", null, getHtmlAttributes("subject"))

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12 col-sm-12 col-xs-12 p-0">

                                    <label class="col-sm-3 col-md-3 col-xs-12 p-0">Email Body</label>
                                    <div>
                                        @Html.TextArea("body", null, new { @style = "min-height:500px !important;", @id = "summernote" })
                                    </div>

                                </div>

                            </div>
                            <div class="m-3">
                                @Html.ActionLink("Back to Admin Settings", "Index", "Admin", null, new { @class = "btn btn-secondary btn-sm" }) &nbsp;
                                <input type="submit" onclick="setvalue();" value="Send Email" class="btn btn-primary btn-sm" />
                            </div>
                        }
                    </div>
                </div><!-- /tab-content --><br />
            </div>

        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('select[multiple="multiple"]').each(function () {
            $(this).multiselect({
                buttonWidth: '100%',
                nonSelectedText: 'All'
            });
        });
    });
    function setvalue() {
        value = $("#RoleList").val();
        $("#RoleListValue").val(value);
    }
</script>











